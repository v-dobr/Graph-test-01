# Дополнительные параметры запросов Microsoft Graph
## Дополнительные параметры запросов OData
В Microsoft Graph предусмотрено несколько дополнительных параметров запросов, с помощью которых можно указывать и регулировать объем возвращаемых данных. Microsoft Graph поддерживает следующие параметры запросов. 

|Имя|Значение|Описание|
|:---------------|:--------|:-------|
|$select|string|Список свойств, включаемых в ответ (разделитель — запятая).|
|$expand|string|Список отношений, развертываемых и включаемых в ответ (разделитель — запятая).  |
|$orderby|string|Список свойств, которые используются для сортировки элементов в коллекции ответов (разделитель — запятая).|
|$filter|string|Фильтрация ответа на основе набора условий.|
|$top|int|Количество элементов, возвращаемых в результирующем наборе.|
|$skip|int|Количество элементов, пропускаемых в результирующем наборе.|
|$skipToken|string|Токен разбиения по страницам, который используется для получения следующего набора результатов.|
|$count|none|Коллекция и количество элементов в коллекции.|


**Кодирование параметров запроса**

- Если вы пользуетесь параметрами запроса в [Microsoft Graph Explorer](https://graphexplorer2.azurewebsites.net/), вы можете просто скопировать и вставить приведенные ниже примеры, не применяя кодировку URL к строке запроса. 
Следующий пример можно использовать _в Graph Explorer_, не кодируя пробелы и кавычки:
```http
GET https://graph.microsoft.com/v1.0/me/messages?$filter=from/emailAddress/address eq 'jon@contoso.com'
``` 
- При указании параметров запроса _в приложении_ убедитесь, что вы правильно кодируете [зарезервированные символы URI](https://tools.ietf.org/html/rfc3986#section-2.2). 
Например, кодируйте пробелы и кавычки в последнем примере, как показано ниже:
```http
GET https://graph.microsoft.com/v1.0/me/messages?$filter=from/emailAddress/address%20eq%20%27jon@contoso.com%27
```

### $select
Чтобы указать подмножество возвращаемых свойств, используйте параметр запроса **$select**. Например, при получении сообщений можно выбрать только свойства **from** и **subject**.

```http
GET https://graph.microsoft.com/v1.0/me/messages?$select=from,subject
```

<!--For example, when retrieving the children of an item on a drive, you want to select that only the **name** and **size** properties of items are returned.

```http
GET https://graph.microsoft.com/v1.0/me/drive/root/children?$select=name,size
```

By submitting the request with the `$select=name,size` query string, the objects
in the response will only have those property values included. 


```json
{
  "value": [
    {
      "id": "13140a9sd9aba",
      "name": "Documents",
      "size": 1024
    },
    {
      "id": "123901909124a",
      "name": "Pictures",
      "size": 1012010210
    }
  ]
}
```--> 

### $expand

В запросах Microsoft Graph API пути к объекту или коллекции указанного элемента не разворачиваются автоматически. Эта особенность позволяет уменьшить сетевой трафик и время создания ответа службой. 
Однако в некоторых случаях эти результаты может потребоваться включить в ответ.

Чтобы API развернул дочерний объект или коллекцию и включил эти результаты, можно использовать параметр строки запроса **$expand**.

Например, параметр **$expand** можно использовать, чтобы получить сведения о корневом диске и дочерних элементах верхнего уровня на диске. 
Кроме того, в этом примере используется оператор **$select**, который возвращает только свойства дочерних элементов _id_ и _name_.

```http
GET https://graph.microsoft.com/v1.0/me/drive/root?$expand=children($select=id,name)
```

>  **Примечание**. Максимальное количество развернутых объектов в запросе — 20. 

> Кроме того, запрашивая ресурс [user](http://graph.microsoft.io/en-us/docs/api-reference/v1.0/resources/user), можно использовать параметр **$expand**, 
чтобы получить свойства только одного дочернего объекта или коллекции за раз. 

В следующем примере возвращаются объекты **user**, каждый из которых содержит до 20 объектов **directReport** в развернутой коллекции **directReports**:
```http
GET https://graph.microsoft.com/v1.0/users?$expand=directReports
```
Другие ресурсы также могут иметь ограничения, поэтому всегда проверяйте наличие ошибок.


<!---The following shows a sample result that is returned in the response body.-->


### $orderby

Чтобы указать порядок сортировки элементов, возвращаемых из API, используйте параметр запроса **$orderby**. 

Например, чтобы возвратить пользователей в организации, упорядочив их по отображаемому имени, используйте следующий синтаксис:

```http
GET https://graph.microsoft.com/v1.0/users?$orderBy=displayName
``` 

Вы также можете сортировать данные по объектам сложного типа. В приведенном ниже примере полученные сообщения сортируются по полю **address** свойства **from**, принадлежащего к сложному типу **emailAddress**.

```http
GET https://graph.microsoft.com/v1.0/me/messages?$orderBy=from/emailAddress/address
``` 

Чтобы отсортировать результаты по возрастанию или убыванию, добавьте `asc` или `desc` к имени поля, разделив их пробелом, например: 
`?orderby=name%20desc`.

 >  **Примечание**. Параметр **$orderby** невозможно использовать в сочетании с выражениями $filter.

### $filter
Чтобы отфильтровать данные ответа на основе набора условий, используйте параметр запроса **$filter**. Например, чтобы возвратить пользователей в организации, 
отфильтровав их по отображаемому имени, которое начинается с "Garth", используйте следующий синтаксис:

```http
GET https://graph.microsoft.com/v1.0/users?$filter=startswith(displayName,'Garth')
```

Вы также можете фильтровать данные по объектам сложного типа. В следующем примере возвращаются сообщения, для которых в поле **address** свойства **from** задано значение "jon@contoso.com". 
**from** — это свойство сложного типа **emailAddress**.

```http
GET https://graph.microsoft.com/v1.0/me/messages?$filter=from/emailAddress/address eq 'jon@contoso.com'
``` 

### $top
Чтобы указать максимальное количество элементов, возвращаемых в результирующем наборе, используйте параметр запроса **$top**. Параметр запроса **$top** определяет подмножество в коллекции. 
В это подмножество включаются первые N элементов набора, где N — положительное целое число, указанное в этом параметре запроса. Например, чтобы возвратить первые пять сообщений в почтовом ящике пользователя, используйте следующий синтаксис:

```http
GET https://graph.microsoft.com/v1.0/me/messages?$top=5
```

### $skip
Чтобы задать количество элементов, которое необходимо пропустить, используйте параметр запроса **$skip**. Например, чтобы возвратить события, начиная с 21, 
отсортировав их по дате создания, используйте указанный ниже синтаксис.

```http
GET  https://graph.microsoft.com/v1.0/me/events?$orderby=createdDateTime&$skip=20
```

### $skipToken
Чтобы разбить данные на страницы и указать следующий набор возвращаемых результатов, используйте параметр запроса **$skipToken**.  Значение параметра запроса **$skipToken** — это токен, определяющий начальную точку в коллекции. Например, значение параметра запроса **$skipToken** может определять первый элемент в коллекции или восьмой элемент в коллекции, содержащей 20 элементов, а также любую другую позицию в коллекции.

Так как значение параметра запроса **$skipToken** определяет индекс в коллекции, используйте его в запросе, чтобы определить подмножество элементов. Определенное подмножество начинается с первого элемента в индексе (на который указывает значение параметра запроса **$skipToken**) и заканчивается последним элементом в наборе.

Некоторые ответы будут содержать значение `@odata.nextLink`. Другие ответы включают значение **$skipToken**.  Значение **$skipToken** — это метка, которая сообщает службе, где необходимо возобновить работу для следующего набора результатов.  Ниже приведен пример значения `@odata.nextLink` из ответа.

```
"@odata.nextLink": "https://graph.microsoft.com/v1.0/users?$orderby=displayName&$top=3&$skiptoken=X%2783630372100000000000000000000%27"
```

Например, чтобы возвратить следующий набор пользователей в организации, ограничив их число в результатах до 3, используйте приведенный ниже синтаксис.

```http
GET  https://graph.microsoft.com/v1.0/users?$orderby=displayName&$top=3&$skiptoken=X%2783630372100000000000000000000%27
```

### $count
Используйте **$count** в качестве параметра запроса, как показано в следующем примере:
```http
GET  https://graph.microsoft.com/v1.0/me/contacts?$count=true
```
Это вернет коллекцию **contacts**, а также количество элементов в коллекции **contacts** в свойстве `@odata.id`.

Примечание. Эта возможность не поддерживается для коллекций [directoryObject](http://graph.microsoft.io/en-us/docs/api-reference/v1.0/resources/directoryobject).
